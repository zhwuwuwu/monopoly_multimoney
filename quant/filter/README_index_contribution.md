# 指数贡献选股策略使用指南

## 概述

指数贡献选股策略 (`IndexContributionFilter`) 是一个用于筛选各板块权重股并基于KDJ指标进行选股的工具。

## 功能特点

1. **板块数据获取**: 自动拉取沪深市场所有板块列表
   - 概念板块
   - 行业板块  
   - 地域板块

2. **权重股筛选**: 从指定板块中选取市值前N的权重股

3. **技术指标筛选**: 使用KDJ指标筛选符合条件的股票

4. **详细信息展示**: 显示每只股票的详细信息和技术指标值

## 使用方法

### 1. 命令行使用

```bash
# 基本用法 - 查看可用板块
python filter/index_contribution_filter.py --date 2025-08-01

# 指定概念板块筛选
python filter/index_contribution_filter.py --date 2025-08-01 --sector_type 概念板块 --sector_code BK0447 --sector_name 白酒概念

# 指定行业板块筛选
python filter/index_contribution_filter.py --date 2025-08-01 --sector_type 行业板块 --sector_code BK0464 --top_n 15

# 自定义KDJ阈值
python filter/index_contribution_filter.py --date 2025-08-01 --sector_code BK0493 --kdj_threshold 10
```

### 2. 程序化使用

```python
from filter.index_contribution_filter import IndexContributionFilter

# 创建筛选器实例
filter = IndexContributionFilter(verbose=True)

# 获取所有板块列表
sectors = filter.get_all_sectors()

# 运行筛选策略
result = filter.run(
    target_date="2025-08-01",
    sector_type="概念板块",
    sector_code="BK0447",  # 白酒概念
    sector_name="白酒概念",
    top_n=10,              # 选取市值前10的股票
    kdj_threshold=15,      # J值小于15
    save_results=True      # 保存结果到CSV
)
```

### 3. 交互式使用

```bash
python test_index_contribution_filter.py
```

## 参数说明

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `target_date` | str | 必填 | 目标日期，格式: YYYY-MM-DD |
| `sector_type` | str | "概念板块" | 板块类型: 概念板块/行业板块/地域板块 |
| `sector_code` | str | None | 板块代码 (如: BK0447) |
| `sector_name` | str | None | 板块名称 (如: 白酒概念) |
| `top_n` | int | 10 | 每个板块选取的权重股数量 |
| `kdj_threshold` | float | 15 | KDJ的J值阈值 |
| `save_results` | bool | True | 是否保存结果到CSV文件 |

## 输出结果

### 控制台输出

```
指数贡献筛选策略 - 目标日期: 2025-08-01
============================================================

正在获取所有板块信息...
获取概念板块...
获取到 442 个概念板块
获取行业板块...
获取到 104 个行业板块
获取地域板块...
获取到 31 个地域板块

板块 [白酒概念] 共有 25 只成分股
选取市值前 10 只权重股进行分析

权重股详细信息:
------------------------------------------------------------
 1. 000858 五粮液      价格:120.50 市值:4891.23亿
 2. 600519 贵州茅台    价格:1650.00 市值:20589.45亿
 3. 000568 泸州老窖    价格:180.25 市值:2695.87亿
 ...

找到符合条件的股票: 000568 泸州老窖, J=12.45

板块 [白酒概念] KDJ<15 的股票筛选结果:
================================================================================
股票代码    股票名称         当前价格    K值     D值     J值     市值
--------------------------------------------------------------------------------
000568     泸州老窖         180.25     15.23   13.84   12.45   2695.87亿
```

### CSV文件输出

筛选结果会保存到 `results/` 目录下，文件名格式为:
`index_contribution_{板块名称}_{日期}.csv`

CSV文件包含以下列:
- symbol: 股票代码
- name: 股票名称
- price: 当前价格
- K: K值
- D: D值
- J: J值
- date: 日期
- market_cap: 市值 (如果可用)

## 常见板块代码

### 热门概念板块
- BK0447: 白酒概念
- BK0464: 半导体
- BK0493: 新能源车
- BK0473: 证券
- BK0478: 有色金属
- BK0481: 汽车整车
- BK0545: 机器人概念

### 主要行业板块
- BK0464: 电子制造
- BK0473: 非银金融
- BK0478: 有色金属
- BK0481: 汽车
- BK0545: 机械设备

### 地域板块
- BK0493: 上海
- BK0495: 深圳
- BK0497: 北京
- BK0499: 浙江

## 注意事项

1. **网络连接**: 需要稳定的网络连接以获取实时数据
2. **数据延迟**: 股票数据可能有延迟，建议使用T-1日期进行分析
3. **交易日**: 确保目标日期为交易日，非交易日可能无法获取数据
4. **代理设置**: 如果使用代理，可能需要调整网络设置

## 扩展功能

可以在此基础上扩展更多功能:

1. **多指标筛选**: 结合MACD、RSI等其他技术指标
2. **基本面筛选**: 加入PE、PB等基本面指标
3. **资金流筛选**: 结合主力资金流向数据
4. **历史回测**: 对筛选策略进行历史数据回测

## 故障排除

### 常见问题

1. **导入错误**: 确保已安装所需依赖包 (pandas, numpy, akshare)
2. **网络错误**: 检查网络连接，确认能访问数据源
3. **数据为空**: 可能是板块代码错误或目标日期非交易日
4. **权限错误**: 确保有写入results目录的权限
